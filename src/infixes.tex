% LTeX: language=en-GB 
% !TeX root=../wqo-on-words.lncs.tex
\section{Infixes and Bounded Languages}
\label{infixes-bounded:sec}

\AP In this section, we study languages equipped with the \kl{infix relation}.
As opposed to the \kl{prefix} and \kl{suffix} relations, the \kl{infix
relation} can lead to very complicated \kl{well-quasi-ordered} languages.
Formally, the upcoming \cref{infix-embedding:thm} due to Kuske shows that
\emph{any} countable partial-ordering with finite initial segments can be
embedded into the infix relation of a language. To make the former statement
precise, let us recall that an \intro{order embedding} from a quasi-ordered set
$(X, \preceq)$ into a quasi-ordered set $(Y, \preceq')$ is a function $f \colon
X \to Y$ such that for all $x, y \in X$, $x \preceq y$ if and only if $f(x)
\preceq' f(y)$. When such an embedding exists, we say that $X$ \reintro{embeds
into} $Y$. Recall that a quasi-ordered set $(X, \preceq)$ is a \kl{partial
ordering} whenever the relation $\preceq$ is antisymmetric, that is $x \preceq
y$ and $y \preceq x$ implies $x = y$. 
A simplified version of the embedding defined in \cref{infix-embedding:thm} is illustrated
for the \kl{subword relation} in \cref{infix-embedding:fig} page \pageref{infix-embedding:fig}.
\begin{lemma}{\cite[Lemma 5.1]{DBLP:journals/ita/Kuske06}}
    \label{infix-embedding:thm}
    Let $(X, \preceq)$ be a \kl{partially ordered} set,
    and $\Sigma$ be an alphabet with at least two letters.
    Then the following are equivalent:
    \begin{enumerate}
        \item 
            $X$ \kl{embeds into} $(\Sigma^*, \infleq)$,
        \item 
            $X$ is countable, and for every $x \in X$,
            its \kl{downwards closure}
            $\dwset[\preceq]{x}$ is finite.
    \end{enumerate}
\end{lemma}

\AP As a consequence of \cref{infix-embedding:thm}, we cannot replay proofs of
\cref{prefixes:sec}, and will actually need to leverage some regularity of the
languages to obtain a characterization of \kl{well-quasi-ordered} languages
under the \kl{infix relation}. This regularity will be imposed through the
notion of \intro{bounded languages}, i.e., languages $L \subseteq \Sigma^*$
such that there exists words $w_1, \dots, w_n$ satisfying $L \subseteq w_1^*
\cdots w_n^*$. Let us now state the main theorem of this section.

\begin{theorem}
    \label{bounded-language:thm}
    \proofref{bounded-language:thm}
    Let $L$ be a \kl{bounded language} of $\Sigma^*$. Then,
    $L$ is a \kl{well-quasi-order} when endowed with the 
    \kl{infix relation} if and only if it included in a finite union of 
    products $S_i \cdot P_i$ where 
    $S_i$ is a \kl{chain} for the \kl{suffix relation}, and 
    $P_i$ is a \kl{chain} for the \kl{prefix relation},
    for all $1 \leq i \leq n$.
\end{theorem}

Let us first remark that if $S$ is a \kl{chain} for the \kl{suffix relation}
and $P$ is a \kl{chain} for the \kl{prefix relation}, then $SP$ is
\kl{well-quasi-ordered} for the \kl{infix relation}. This proves the (easy)
right-to-left implication of \cref{bounded-language:thm}. 

\AP In order to prove the (difficult) left-to-right implication of
\cref{bounded-language:thm}, we will rely heavily on the combinatorics of
periodic words. Let us use a slightly non-standard notation by saying that a
non-empty word $w \in \Sigma^+$ is \intro(word){periodic} with period $x \in
\Sigma^*$ if there exists a $p \in \Nat$ such that $w \infleq x^p$. The
\intro{periodic length} of a word $u$ is the minimal length of a period $x$ of
$u$.

The reason why \kl{periodic words} built using a given period $x \in \Sigma^+$
are interesting for the \kl{infix relation} is that they naturally create
\kl{chains} for the \kl{prefix} and \kl{suffix} relations. Indeed, if $x \in
\Sigma^+$ is a finite word, then $\setof{x^p}{p \in \Nat}$ is a \kl{chain} for
the \kl{infix relation}. Note that in general, the \kl{downwards closure} of a
chain is \emph{not} a chain (see \cref{dw-closure-not-wqo:rem}). However, for
the chains generated using periodic words, the \kl{downwards closure}
$\dwset[\infleq]{\setof{x^p}{p \in \Nat}}$ is a \emph{finite union} of
\kl{chains}. Because this set will appear in bigger equations, we introduce the
shorter notation $\intro*\InfPeriodChain{x}$ for the set of \kl{infixes} of
words of the form $x^p$, where $p \in \Nat$.


\begin{remark}
    \label{dw-closure-not-wqo:rem}
    Let $(X,\preceq)$ be a quasi-ordered set, and $L \subseteq X$ be such that $(L,
    \preceq)$ is \kl{well-quasi-ordered}. It is not true in general that
    $(\dwset{L}, \preceq)$ is \kl{well-quasi-ordered}. In the case of $(\Sigma^*,
    \infleq)$ a typical example is to start from an infinite \kl{antichain} $A$,
    together with an enumeration $\seqof{w_i}[i \in \Nat]$ of $A$, and build the language $L
    \defined \setof{ \prod_{i = 0}^n w_i }{ i \in \Nat }$. By definition, $L$ is a
    \kl{chain} for the \kl{infix} ordering, hence \kl{well-quasi-ordered}. However,
    $\dwset[\infleq]{L}$ contains $A$, and is therefore not
    \kl{well-quasi-ordered}. 
\end{remark}

\begin{lemma}
    \label{inf-period-chain:lem}
    \proofref{inf-period-chain:lem}
    Let $x \in \Sigma^+$ be a word.
    Then $\InfPeriodChain{x}$ is a finite union of \kl{chains}
    for the \kl{infix}, \kl{prefix} and \kl{suffix} relations 
    simultaneously.
\end{lemma}



The following combinatorial \cref{pumping-periods:lem} connects the property of
being \kl{well-quasi-ordered} to a property of the \kl{periodic lengths} of
words in a language, based on the assumption that some factors can be iterated.
It is the core result that powers the analysis done in the upcoming
\cref{bounded-language:thm,infix-amalgamation:thm}. It is fundamentally based
on a classical result of combinatorics on words (\cref{periodic-gcd:lem}) that
we recall here for the sake of completeness.

\begin{lemma}[{\cite[Theorem 1]{FIWI65}}]
  \label{periodic-gcd:lem}
  Let $u,v \in \Sigma^+$ be two 
  words and $n = \gcd(\card{u}, \card{v})$.
  If there exists $p,q \in \Nat$ such that
  $u^p$ and $v^q$ have a common prefix of length at least $\card{uv} - n$,
  then there exists $z \in \Sigma^+$ such that $u$ and $v$ are powers of $z$,
  and in particular $z$ has length at most $\min\{\card{u}, \card{v}\}$.
\end{lemma}

\begin{lemma}
    \label{pumping-periods:lem}
    \proofref{pumping-periods:lem}
    Let $L \subseteq \Sigma^*$ be a language
    that is \kl{well-quasi-ordered} by the \kl{infix relation}.
    Let $k \in \Nat$, $u_1, \cdots, u_{k+1} \in \Sigma^*$,
    and $v_1, \cdots, v_{k} \in \Sigma^+$
    be such that
    $w[\vec{n}] \defined (\prod_{i = 1}^k u_i v_i^{n_i}) u_{k+1}$
    belongs to $L$
    for arbitrarily large values of $\vec{n} \in \Nat^k$.
    Then, 
    there exists $x,y \in \Sigma^+$ of size 
    at most $\max \setof{\card{v_i}}{1 \leq i \leq k}$
    such that
    for all
    $\vec{n} \in \Nat^{k}$
    one of the following holds:
    \begin{enumerate}
        \item $w[\vec{n}] \in u_1 \InfPeriodChain{x}$,
        \item $w[\vec{n}] \in \InfPeriodChain{x} u_{k+1}$,
        \item $w[\vec{n}] \in \InfPeriodChain{x} u_i \InfPeriodChain{y}$
            for some $1 \leq i \leq k + 1$.

    \end{enumerate}
\end{lemma}

\begin{lemma}
    \label{bounded-language:lem}
    \proofref{bounded-language:lem}
    Let $L \subseteq \Sigma^*$ be a \kl{bounded language}
    that is \kl{well-quasi-ordered} by the \kl{infix relation}.
    Then, there exists a finite subset $E \subseteq (\Sigma^*)^3$,
    such that:
    \begin{equation*}
        L \subseteq \bigcup_{(x,u,y) \in E} \InfPeriodChain{x} u \InfPeriodChain{y}
        \quad .
    \end{equation*}
\end{lemma}


\begin{proofof}{bounded-language:thm}
    We apply \cref{bounded-language:lem}, and conclude
    because $\InfPeriodChain{x}$ is a finite union of \kl{chains}
    for the \kl{prefix}, \kl{suffix} and \kl{infix} relations
    (\cref{inf-period-chain:lem}).
\end{proofof}


\begin{corollary}
    \label{ordinal-invariants-bounded:cor}
    \proofref{ordinal-invariants-bounded:cor}
    Let $L$ be a \kl{bounded language} of $\Sigma^*$
    that is \kl{well-quasi-ordered} by the \kl{infix relation}.
    Then, the \kl{ordinal width} of $L$ less than $\omega^2$,
    its \kl{ordinal height} is at most $\omega$,
    and its \kl{maximal order type} less than $\omega^3$.
    Furthermore, those three bounds are tight.
\end{corollary}
\begin{proof}
  Upper bounds are a direct consequence of \cref{bounded-language:thm},
  and the tightness is witnessed by the 
  languages: 
  $L_k \defined \bigcup_{i = 2}^{k+1} (a b^i a)^* (b a^i b)^*$,
  that are \kl{bounded languages} of $\set{a,b}^*$,
  \kl{well-quasi-ordered} by the \kl{infix relation},
  and have \kl{ordinal width}, \kl{ordinal height} and
  \kl{maximal order type} respectively equal to $\omega \cdot k$, $\omega$ and
  $\omega^2 \cdot k$.
\end{proof}

\section{Infixes and Downwards Closed Languages}
\label{infixes-dwclosed:sec}

Let us now discuss another classical restriction that can be imposed on 
languages when studying \kl{well-quasi-orders}, that of being
\kl{downwards closed}. Indeed, the \cref{infix-embedding:thm}
crucially relies on constructing languages that are \emph{not}
\kl{downwards closed}, and we have shown 
in \cref{dw-closure-not-wqo:rem} that the \kl{downwards closure}
of a \kl{well-quasi-ordered} language is not necessarily
\kl{well-quasi-ordered}.

\subsection{Characterization of Well-Quasi-Ordered Downwards Closed Languages}

An immediate consequence of \cref{bounded-language:thm} is that   if $L$ is a
\kl{bounded language}, then considering $L$ or its \kl{downwards closure}
$\dwset[\infleq]{L}$ is equivalent with respect to being
\kl{well-quasi-ordered} by the \kl{infix relation}, as opposed to
the general case illustrated in \cref{dw-closure-not-wqo:rem}.

\begin{corollary}
    \label{bounded-wqo-dwclosed:cor}
    \proofref{bounded-wqo-dwclosed:cor}
    Let $L$ be a \kl{bounded language} of $\Sigma^*$. Then,
    $L$ is a \kl{well-quasi-order} when endowed with the
    \kl{infix relation} if and only if $\dwset[\infleq]{L}$ is.
\end{corollary}



The \cref{bounded-wqo-dwclosed:cor} is reminiscent of a similar result for the
\kl{subword embedding},  stipulating that for any language $L \subseteq
\Sigma^*$, the \kl{downwards closure} $\dwset[\higleq]{L}$ is described using
finitely many excluded \kl{subwords}, hence is regular. However, this is not
the case for the \kl{infix relation}, even with \kl{bounded languages}, as we
will now illustrate with the following example.

\begin{example}
    \label{dwclosed-wqo-not-finite-excl:ex}
    Let $L \defined a^* b^* \cup b^* a^*$. This language is 
    \kl(language){bounded}, is \kl{downwards
    closed} for the \kl{infix relation}, is \kl{well-quasi-ordered} for the
    \kl{infix relation}, but is characterized by an \emph{infinite} number 
    of excluded infixes, respectively of the form $ab^ka$ and $ba^kb$ where $k \geq 1$.
\end{example}

To strengthen \cref{dwclosed-wqo-not-finite-excl:ex}, we will
leverage the \intro{Thue-Morse sequence} $\intro*\ThueMorse \in
\set{0,1}^{\Nat}$, which we will use as a black-box for its two main
characteristics: it is \kl{cube-free} and \kl{uniformly recurrent}. Being
\intro{cube-free} means that no (finite) word of the form $uuu$ is an
\kl{infix} of $\ThueMorse$, and being \intro{uniformly recurrent} means that
for every word $u$ that is an \kl{infix} of $\ThueMorse$, there exists $k \geq
1$ such that $u$ occurs as an \kl{infix} of every $k$-sized infix $v \infleq \ThueMorse$. 
We refer the reader to a nice survey of Allouche and Shallit for more information
on this sequence and its properties \cite{ALSHA99}.

\begin{theorem}
    \label{uniformly-recurrent:lem}
    Let $w \in \Sigma^\Nat$ be a \kl{uniformly recurrent} word.
    Then, the set of finite \kl{infixes} of $w$ is \kl{well-quasi-ordered} for the \kl{infix relation}.
\end{theorem}
\begin{proof}
    Let $L$ be the set of finite \kl{infixes} of $w$.
    Consider a sequence $\seqof{u_i}[i \in \Nat]$ of words in $L$. Without loss of
    generality, we may consider a subsequence such that $\card{u_i} <
    \card{u_{i+1}}$ for all $i \in \Nat$. Because $\ThueMorse$ is \kl{uniformly
    recurrent}, there exists $k \geq 1$ such that $u_1$ is an \kl{infix} of
    every word $v$ of size at least $k$. In particular, $u_1$ is an \kl{infix}
    of $u_k$, hence the sequence $\seqof{u_i}[i \in \Nat]$ is \kl(sequence){good}.
\end{proof}


\begin{lemma}
    \label{thue-morse:lemma}
    The language $\intro*\LMorse$ of \kl{infixes} of the \kl{Thue-Morse sequence}
    is \kl{downwards closed} for the \kl{infix
    relation}, \kl{well-quasi-ordered} for the \kl{infix relation}, but is not
    \kl(language){bounded}.
\end{lemma}
\begin{proof}
    By construction $\LMorse$ is
    \kl{downwards closed} for the \kl{infix relation},
    and by \cref{uniformly-recurrent:lem}, it is
    \kl{well-quasi-ordered}.

    Assume by contradiction that $\LMorse$ is \kl(language){bounded}. In this case, there exist
    words $w_1, \dots, w_k \in \Sigma^*$ such that $\LMorse \subseteq w_1^* \cdots
    w_k^*$. Since $\LMorse$ is infinite and \kl{downwards closed}, there exists a
    word $u \in \LMorse$ such that $u = w_i^3$ for some $1 \leq i \leq k$. This is a contradiction,
    because $u \infleq \ThueMorse$, which is \kl{cube-free}.
\end{proof}

One may refine our analysis of the \kl{Thue-Morse sequence} to obtain 
precise bounds on the \kl{ordinal invariants} of its language of \kl{infixes}.

\begin{lemma}
    \label{thue-morse-ordinal:lemma}
    Under $\infleq$,
    the \kl{maximal order type} of $\LMorse$ is $\omegaOrd$,
    the \kl{ordinal height} of $\LMorse$ is $\omegaOrd$,
    the \kl{ordinal width} of $\LMorse$ is $\omegaOrd$.
\end{lemma}
\begin{proof}
	We first show that $\omegaOrd$ is an upper bound for each of these measure, 
	before showing that the bounds are tight.
	
    Let us prove that these are upper bounds for the \kl{ordinal invariants} of
    $\LMorse$. The bound of the \kl{ordinal height} holds for any language $L$,
    as the length of a decreasing sequence of words is bounded by the length of
    its first element. For the \kl{maximal order type}, we remark that the
    \kl{uniform recurrence} of $\ThueMorse$ means that the maximal length of a
    \kl{bad sequence} is determined by its first element, hence that it is at
    most $\omegaOrd$. Finally, because the \kl{ordinal width} is at most the
    \kl{maximal order type} (as per \cref{ordinal-invariants:subsec}, using for instance the
    results of \cite{kriz90b} or \cite[Theorem 3.8]{DZSCSC20} stating 
    $\oType{X} \leq \oHeight{X} \oComProd \oWidth{X}$): we conclude
    that the \kl{ordinal width} is also at most $\omegaOrd$.

    Now, let us prove that these bounds are tight. It is clear that
    $\oHeight{\LMorse} = \omegaOrd$: given any number $n \in \Nat$, one can construct a
    \kl{decreasing sequence} of words in $\LMorse$ of length $n$, for instance by
    considering the first $n$ prefixes of the \kl{Thue-Morse sequence} by
    decreasing size.
    Let us now prove that $\oWidth{\LMorse} = \omegaOrd$. 
    To that end, we can leverage the fact that 
    the number of infixes of size $n$ in $\LMorse$ is bounded below by
    a non-constant affine function in $n$
    \cite{TRSHA95}, and that two words of length $n$ are comparable
    for the \kl{infix relation}
    if and only if they are equal. Hence, there cannot be a bound
    on the size of an \kl{antichain} in $\LMorse$, and we conclude
    that $\oWidth{\LMorse} = \omegaOrd$.
    Finally, because the \kl{ordinal width} is at most the \kl{maximal order
    type}, we conclude that the \kl{maximal order type} of $\LMorse$ is also $\omegaOrd$.
\end{proof}

\AP We prove in the upcoming \cref{dw-closed-wqo-charac:thm} that the status of
the \kl{Thue-Morse sequence} is actually representative of \kl{downwards
closed} languages for the \kl{infix relation}. To that end, let us introduce
the notation $\intro*\infset{w}$ for the set of finite \kl{infixes} of a
(possibly infinite or bi-infinite) word $w \in \Sigma^* \cup \Sigma^\Nat \cup
\Sigma^\Rel$. We say that an infinite word $w \in \Sigma^\Nat$ is
\intro{ultimately uniformly recurrent} if there exists a bound $N_0 \in \Nat$
such that $w_{\geq N_0}$ is \kl{uniformly recurrent}. We extend this notion to
finite words by considering that they all are \kl{ultimately uniformly
recurrent}, and to bi-infinite words by considering that they are
\kl{ultimately uniformly recurrent} if and only if both their left-infinite and
right-infinite parts are.

\begin{theorem}
    \label{dw-closed-wqo-charac:thm}
    \proofref{dw-closed-wqo-charac:thm}
    Let $L$ be a \kl{well-quasi-ordered} language for the \kl{infix relation}
    that is \kl{downwards closed}.
    Then, there exist finitely many \kl{ultimately uniformly recurrent words} 
    $w_1, \dots, w_n \in \Sigma^* \cup 
    \Sigma^\Nat \cup \Sigma^\Rel$ such that
    $L = \bigcup_{i = 1}^n \infset{w_i}$.
\end{theorem}

Thanks to \cref{dw-closed-wqo-charac:thm}, and by analysing 
the \kl{ordinal invariants} of \kl{infixes} of an \kl{ultimately uniformly recurrent}
infinite word $w$ (\cref{ultimately-uniformly-recurrent:lem}),
we conclude that the \kl{ordinal invariants} of a \kl{well-quasi-ordered}
\kl{downwards closed} language are relatively small.

\begin{corollary}
  \label{small-ordinal-invariants:thm}
  \proofref{small-ordinal-invariants:thm}
    Then, the \kl{maximal order type} of $L$ is strictly less than $\omegaOrd^3$,
    its \kl{ordinal height} is at most $\omegaOrd$,
    and its \kl{ordinal width} is at most $\omegaOrd^2$.

    Furthermore, those bounds are tight.
\end{corollary}

\AP To connect infixes of a (bi)-infinite word to \kl{downwards closed}
languages, a useful notion is that of \kl(subset){directed} sets. A subset $I
\subseteq X$ is \intro(subset){directed} if, for every $x,y \in I$, there
exists $z \in I$ such that $x \leq z$ and $y \leq z$. Given a
\kl{well-quasi-order} $(X, \leq)$, one can always decompose $X$ into a finite
union of \intro{order ideals}, that is, non-empty sets $I \subseteq X$ that are
\kl{downwards closed} and \kl(subset){directed} for the relation $\leq$. In our
case, a \kl{well-quasi-ordered} \kl{order ideal} for the \kl{infix relation} is
the set of finite \kl{infixes} of a finite, infinite, or bi-infinte word $w \in
\Sigma^* \cup \Sigma^\Nat \cup \Sigma^\Rel $ (\cref{bi-infinite:lem}). 

\begin{lemma}
    \label{bi-infinite:lem}
    \proofref{bi-infinite:lem}
    Let $L \subseteq \Sigma^*$ be an \kl{order ideal} 
    for a \kl{well-quasi-ordered} 
    \kl{infix relation}. Then $L$ is the set of finite \kl{infixes}
    of a finite, infinite or bi-infinite word $w$.
\end{lemma}

\begin{lemma}
    \label{ultimately-uniformly-recurrent:lem}
    \proofref{ultimately-uniformly-recurrent:lem}
    Let $w \in \Sigma^\Nat$ be an infinite word. 
    Then, the set of finite infixes of $w$ is \kl{well-quasi-ordered} for the \kl{infix relation}
    if and only if $w$ is \kl{ultimately uniformly recurrent}.
\end{lemma}

\begin{lemma}
  \label{bi-infinite-uur:lem}
  \proofref{bi-infinite-uur:lem}
    Let $w \in \Sigma^\Rel$ be a bi-infinite word. Then, the set of finite
    infixes of $w$ is \kl{well-quasi-ordered} for the \kl{infix relation} if
    and only if $w$ is \kl{ultimately uniformly recurrent} as a bi-infinite word.
\end{lemma}

We are now ready to conclude the proof of \cref{dw-closed-wqo-charac:thm}.

\begin{proofof}{dw-closed-wqo-charac:thm}
  It is clear that the set of finite \kl{infixes} of a finite, infinite or
  bi-infinite \kl{ultimately uniformly recurrent} word is \kl{well-quasi-ordered}
  for the \kl{infix relation} thanks to \cref{ultimately-uniformly-recurrent:lem}.

  Conversely, let us consider a \kl{well-quasi-ordered} language $L$ that is
  \kl{downwards closed} for the \kl{infix relation}. Because it is a
  \kl{well-quasi-ordered} set, it can be written as a finite union of \kl{order
  ideals} $L = \bigcup_{i = 1}^n L_i$.

  For every such \kl(order){ideal} $L_i$, we can apply
  \cref{bi-infinite:lem}, and conclude that $L_i$ is the set of finite
  \kl{infixes} of a finite, infinite or bi-infinite word $w_i$. 
  Because the languages $L_i$ are \kl{well-quasi-ordered}, we can apply
  \cref{ultimately-uniformly-recurrent:lem}, and conclude that $w_i$ is
  \kl{ultimately uniformly recurrent}.
\end{proofof}

Finally, we comment on the \kl{ordinal invariants} of the set of finite
\kl{infixes} of an \kl{ultimately uniformly recurrent} infinite word, from
which the bounds of \cref{small-ordinal-invariants:thm} naturally follow (the
proof is in \cref{small-ordinal-invariants:thm:proof} page
\pageref{small-ordinal-invariants:thm:proof}).

\begin{lemma}
    \label{small-ordinal-invariants:lem}
    \proofref{small-ordinal-invariants:lem}
    Let $w \in \Sigma^\Nat$ be an \kl{ultimately uniformly recurrent} word.
    Then, the set of finite infixes of $w$ has \kl{ordinal width}
    less than $\omegaOrd \cdot 2$.
    Furthermore, this bound is tight. 
\end{lemma}

\begin{lemma}
    \label{from-bi-to-single:lem}
    \proofref{from-bi-to-single:lem}
    Let $w \in \Sigma^\Rel$ be a bi-infinite word. Then, the set of finite
    infixes of $w$ is \kl{well-quasi-ordered} for the \kl{infix relation} if
    and only if $w_+$ and $w_-$ are two \kl{ultimately uniformly recurrent}
    words. In this case, the \kl{ordinal width}
    of the set of finite infixes of $w$ is less than $\omegaOrd \cdot 3$,
    and this bound is tight.
\end{lemma}

\subsection{Decision Procedures}
\label{decision-procedures:sec}

\AP As we have demonstrated, infinite (or bi-infinite words) can be used to
represent languages that are \kl{well-quasi-ordered} for the \kl{infix
relation} by considering their set of finite \kl{infixes}.
Let us formalise the representation of languages by sets of bi-infinite
words that we will use in this section, following the characterization of
\cref{bi-infinite:lem}. A \intro{sequence representation} of a language $L
\subseteq \Sigma^*$ is a finite set of triples $(w_i^-, a_i, w_i^+)_{1 \leq i
\leq n}$ where $w_i^-, w_i^+ \in \Sigma^\Nat \cup \Sigma^*$ are two potentially
infinite words, and $a_i \in \Sigma$ is a letter, such that
\begin{equation*}
    L = \bigcup_{i = 1}^n \infset{\mathsf{reversed}(w_i^-) a_i w_i^+} \quad .
\end{equation*}

\AP Given an effective representation of sequences, one obtains an effective
representation of languages via \kl{sequence representations}. In this section,
we will rely on definitions originating from the area of symbolic dynamics,
that precisely study infinite words whose generation follows from a finitely
described process. However, we will not assume that the reader is familiar with
this domain, and we will use as black-boxes key results from this area.

\AP A first model that one can use to represent infinite words is the model of
\intro{automatic sequences}. In this case, the infinite word $w$ is described
by a finite state automaton, that can compute the $i$-th letter of the word $w$
given as input the number $i$ written in some base $b \in \Nat$. An example of
such a sequence is the \kl{Thue-Morse sequence} that can be described by a
finite automaton using a binary representation of the indices. The good
algorithmic properties of \kl{automatic sequences} come from the fact that a
Presburger definable property that uses letters of the sequence can be
(trivially) translated into a finite automaton that reads the base $b$
representation of the free variables (that are indices of the sequence). It is
folklore that one can decide if an \kl{automatic sequence} is \kl{ultimately
uniformly recurrent}. A proof can be found in the appendix at
\cref{automatic-uur:lem}. Based on this, we now prove:


\begin{theorem}
    \label{automatic-wqo:thm}
    Given a \kl{sequence representation} of a language $L \subseteq
    \Sigma^*$ where all infinite words are \kl{automatic sequences}, one can
    decide whether $L$ is \kl{well-quasi-ordered} for the \kl{infix relation}.
\end{theorem}
\begin{proof}
    It is easy to see that $L$ is \kl{well-quasi-ordered} for the \kl{infix
    relation} if and only if for every triple $(w_i^-, a_i, w_i^+)$ in the
    \kl{sequence representation} of $L$, the (potentially bi-infinite) word
    $\mathsf{reversed}(w_i^-) a_i w_i^+$ defines a \kl{well-quasi-ordered}
    language. By \cref{from-bi-to-single:lem}, this is the case if and only if
    both $w_i^-$ and $w_i^+$ are \kl{ultimately uniformly recurrent}. 
    Since one can decide whether an \kl{automatic sequence} is
    \kl{ultimately uniformly recurrent} using \cref{automatic-uur:lem},
    we conclude the proof.
\end{proof}


\AP In fact, \kl{automatic sequences} are part of a larger family of sequences
studied in symbolic dynamics, called \kl{morphic sequences}. Let us first
recall that a \intro(words){morphism} is a function $f \colon \Sigma^* \to
\Gamma^*$ such that for every $u,v \in \Sigma^*$, $f(uv) = f(u)f(v)$. A
\intro{morphic sequence} $w$ is an infinite word obtained by iterating a
\kl(words){morphism} $f \colon \Sigma^* \to \Sigma^*$ on a letter $a \in
\Sigma$ such that $f(a)$ starts with $a$, and then applying a
\kl(words){homomorphism} $h \colon \Sigma^* \to \Gamma^*$. The infinite word
$f^\omega(a)$ is the limit of the sequence $\seqof{f^n(a)}[n \in \Nat]$, which
is well-defined because $f(a)$ starts with $a$, and the \kl{morphic sequence}
is $ w \defined h(f^\omega(a))$. 

\AP
Every \kl{automatic
sequence} is a \kl{morphic sequence}, but not the other way around. We refer
the reader to a short survey of \cite{ALSZ17} for more details on the possible
variations on the definition of \kl{morphic sequences} and their relationships.
It was relatively recently proven that one can decide whether a \kl{morphic
sequence} is \kl{uniformly recurrent} \cite[Theorem 1]{DURAND13}. We were not
able to find in the literature whether one can decide \kl{ultimate uniform
recurrence}, but conjecture that it is the case, which would allow us to
decide whether a language represented by \kl{morphic sequences} is
\kl{well-quasi-ordered} for the \kl{infix relation}.

\begin{conjecture}
  \label{morphic-uur:conj}
    Given a \kl{morphic sequence} $w \in \Sigma^{\Nat}$, one can decide
    whether it is \kl{ultimately uniformly recurrent}.
\end{conjecture}
