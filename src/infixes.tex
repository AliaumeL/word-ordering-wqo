% LTeX: language=en-GB 
\section{Infixes and Bounded Languages}
\label{infixes-regular:sec}

\todo{Delete this section: the \cref{infix-embedding:thm} is already
    known, we should just restate it. The
    \cref{infix-finite-automata:thm} is a direct consequence of
    \cref{infix-amalgamation:thm} and \cref{bounded-language:thm}.
    I don't know if we should keep it for clarity, but it does not 
    seems to be necessary to me.
}

\AP
In this section, we study languages equipped with the \kl{infix relation}. As
opposed to the \kl{prefix} and \kl{suffix} relations, the \kl{infix relation}
can yield to very complicated \kl{well-quasi-ordered} languages. Formally, the
upcoming \cref{infix-embedding:thm} shows that \emph{any} countable
partial-ordering with finite initial segments can be embedded into the infix
relation of a language. To make the former statement precise,
Let us recall that an \intro{order embedding} from a quasi-ordered set $(X,
\preceq)$ into a quasi-ordered set $(Y, \preceq')$ is a function $f \colon X
\to Y$ such that for all $x, y \in X$, $x \preceq y$ if and only if $f(x)
\preceq' f(y)$. When such an embedding exists, we say that $X$ \reintro{embeds
into} $Y$. We say that a quasi-ordered set $(X, \preceq)$ is a \intro{partial
ordering} whenever the relation $\preceq$ is antisymmetric, that is $x \preceq
y$ and $y \preceq x$ implies $x = y$. 

The following result due to Kuske shows the structural complexity of the \kl{infix relation}

\begin{lemma}{\cite[Lemma 5.1]{DBLP:journals/ita/Kuske06}}
    \label{infix-embedding:thm}
    Let $(X, \preceq)$ be a \kl{partially ordered} set,
    and $\Sigma$ be an alphabet with at least two letters.
    Then the following are equivalent:
    \begin{enumerate}
        \item \label{infix-embedding-embeds:item} 
            $X$ \kl{embeds into} $(\Sigma^*, \infleq)$,
        \item \label{infix-embedding-count:item}
            $X$ is countable, and for every $x \in X$,
            its \kl{downwards closure}
            $\dwset[\preceq]{x}$ is finite.
    \end{enumerate}
\end{lemma}
\begin{figure}
    \centering
    \includestandalone[width=\linewidth]{fig/infix-encoding-standalone}
    \caption{Representation of the \kl{subword relation} for $\set{a,b}^*$
        inside the \kl{infix relation} for $\set{a,b,\#}^*$
        using the encoding of \cref{infix-embedding:thm}, restricted to words
        of length at most $3$. To obtain smaller words,
        we replaced $D_i$ by $\max D_i$ in this construction.
    }
    \label{infix-embedding:fig}
\end{figure}

As a consequence of \cref{infix-embedding:thm}, we cannot replay proofs of
\cref{prefixes:sec}, and will actually need to leverage some regularity of the
languages to obtain a characterization of \kl{well-quasi-ordered} languages
under the \kl{infix relation}. Let us first play this game for languages that
are recognized by finite automata. We assume that the reader is familiar with
the notions of deterministic finite automaton and regular languages, and refer
to the book of Thomas for a comprehensive introduction to the subject
\cite{THOM97}. The main goal of the remainder of this section is to prove the
following \cref{infix-finite-automata:thm}.

\begin{theorem}[restate=infix-finite-automata:thm,label=infix-finite-automata:thm]
    \proofref{infix-finite-automata:thm}
    Let $L \subseteq \Sigma^*$ be a language recognized by a finite automaton.
    Then $L$ is \kl{well-quasi-ordered} by the \kl{infix relation} if and only if $L$ is
    a finite union of \kl{chains} for the \kl{infix relation}.
\end{theorem}

\AP In order to prove \cref{infix-finite-automata:thm}, we will perform some
preliminary analysis on the structure of an automaton recognizing a
well-quasi-ordered language under the infix relation, which will be powered by
folklore results on \emph{periodic} words. Let us recall that a non-empty word
$w \in \Sigma^+$ is \intro(word){periodic} with period $x \in \Sigma^*$ if
there exists a $p \in \Nat$ such that $w \infleq x^p$. The \intro{periodic
length} of a word $u$ is the minimal length of a word $x$ such that $u$ is an
\kl{infix} of $x^p$ for some $p \in \Nat$ and $x \in \Sigma^+$. We will
essentially rely on the following result on periodic words.

\begin{lemma}
    \label{periodic-infixes:lem}
    Let $u,v \in \Sigma^*$ be two (non-empty) \kl{periodic words}
    having \kl{periodic lengths} $p$ and $q$ respectively.
    Then, if $u \infleq v$ and $\card{u} \geq \factorial[p]{p \times q}$,
    then $u$ and $v$ share the same \kl{periodic length}
    $p = q$.
\end{lemma}
\begin{proof}
    The fact that $u$ and $v$ are \kl{periodic length}
    respectively $p$ and $q$ translates into the fact that $u_{i+p} = u_i$ and
    $v_{i+q} = v_i$ for all indices $i \in \Nat$ such that those letters are
    well-defined.

    Now, assume that $u$ is an \kl{infix} of $v$, this provides the existence
    of a $k \in \Nat$ such that $u = v_{k} \cdots v_{k + \card{u} - 1}$. In
    particular, $v_{k+i+p} = v_{k+i}$ for all $i \in \Nat$ such that $k+i+p < k
    + \card{u}$. Since we also have $v_{k+i+q} = v_{k+i}$ for all $1 \leq i
    \leq \card{v} - k - q$. We conclude that both $u$ and $v$ are of
    \kl{periodic length} the greatest common divisor of $p$ and $q$, and by
    minimality of $q$ this must be equal to $q$ and to $p$.
\end{proof}

The upcoming \cref{powers-infixes:cor} is based on the observation that if $S$
is a \kl{chain} for the \kl{suffix relation} and $P$ is a \kl{chain} for the
\kl{prefix relation}, then $SP$ is a \kl{chain} for the \kl{infix relation}.

\begin{corollary}
    \label{powers-infixes:cor}
    Let $u,v \in \Sigma^*$ and $k, \ell \in \Nat$
    such that $k \geq \factorial[p]{\card{u} \times \card{v}}$,
    $\ell \geq \factorial[p]{\card{v} \times \card{u}}$,
    and $u^k \infleq v^\ell$.
    Then, there exists $w \in \Sigma^*$ of size at most
    $\min \set{\card{u}, \card{v}}$ and a $p \in \Nat$
    such that
    $u^k \infleq v^\ell \infleq w^p$.
\end{corollary}

The reason why \kl{periodic words} built using a given period $x \in \Sigma^+$
are interesting for the \kl{infix relation} is that they naturally create
\kl{chains}. Indeed, if $x \in \Sigma^+$ is a finite word, then $\setof{x^p}{p
\in \Nat}$ is a \kl{chain} for the \kl{infix relation}. Note that in general,
the \kl{downwards closure} of a chain is \emph{not} a chain. However, for the
chains generated using periodic words, the \kl{downwards closure}
$\dwset[\infleq]{\setof{x^p}{p \in \Nat}}$ is a \emph{finite union} of
\kl{chains}. Because this set will appear in bigger equations, we introduce the
shorter notation $\intro*\InfPeriodChain{x}$ for the set of \kl{infixes} of
words of the form $x^p$, where $p$ ranges over $\Nat$.

\begin{lemma}
    \label{inf-period-chain:lem}
    Let $x \in \Sigma^+$ be a word, and
    Then $\InfPeriodChain{x}$ is a finite union of \kl{chains}
    for the \kl{infix}, \kl{prefix} and \kl{suffix} relations 
    simultaneously.
\end{lemma}
\begin{proof}
    Let $x \in \Sigma^+$ be a word, and let $P_x$ be the (finite) set 
    of all \kl{prefixes} of $x$, and $S_x$ be the (finite)
    set of all \kl{suffixes} of $x$.
    Assume that $w \in \InfPeriodChain{x}$, then $w = u x^p v$ for some
    $u \in S_x$, $v \in P_x$, and $p \in \Nat$.
    We have proven that
    \begin{equation*}
        \InfPeriodChain{x} \subseteq \bigcup_{u \in P_x} \bigcup_{v \in S_x} u x^* v
        \quad .
    \end{equation*}

    Let us now demonstrate that for all $(u,v) \in S_x \times P_x$, the
    language $u x^* v$ is a \kl{chain} for the \kl{infix}, \kl{suffix} and \kl{prefix} relations.
    To that end,
    let $(u,v) \in S_x \times P_x$ and $\ell, k \in \Nat$ be such that $\ell <
    k$, let us prove that $u x^\ell v \infleq u x^k  v$. Because $v \prefleq
    x$, we know that there exists $w$ such that $vw = x$. In particular,
    $ux^\ell vw = u x^{\ell + 1}$, and because $\ell < k$, we conclude that $u
    x^{\ell + 1} \prefleq u x^k v$. By transitivity, $u x^\ell v \prefleq u x^k
    v$, and \emph{a fortiori}, $u x^\ell v \infleq u x^k v$. 
    Similarly, because $u \suffleq x$,  there exists $w$ such that $wu  = x$, 
    and we conclude that $u x^{\ell} v \suffleq w u x^\ell v = x^{\ell + 1} v \suffleq u x^k v$.
    \qedhere
\end{proof}


\begin{corollary}
    \label{inf-period-union-chains:lem}
    Let $x,u,y \in \Sigma^*$ be words.  The following 
    are finite unions of \kl{grids} for the infix relation:
    $\InfPeriodChain{x}u$, $u \InfPeriodChain{x}$,
    and $\InfPeriodChain{x} u \InfPeriodChain{y}$.
\end{corollary}
\begin{proof}
    Because $\InfPeriodChain{x}$ is a finite union of \kl{chains} for the \kl{suffix}
    relation (rsing \cref{inf-period-chain:lem}), we conclude that $\InfPeriodChain{x}u$ is one too for
    the \kl{infix} relation. This holds similarly for $u \InfPeriodChain{x}$.
    In the case of $\InfPeriodChain{x} u \InfPeriodChain{y}$,
    we remark that $\InfPeriodChain{x} u$ is a finite union of chains
    for the \kl{suffix relation},
    and that $\InfPeriodChain{y}$ is one for the \kl{prefix relation}
    (using again \cref{inf-period-chain:lem}).
    As a consequence,
    $\InfPeriodChain{x}u \InfPeriodChain{y}$ is a finite union 
    of \kl{chains} for the \kl{infix} relation.
\end{proof}

The following combinatorial lemma connects the property of being
\kl{well-quasi-ordered} to a property of the \kl{periodic lengths} of words in
a language, based on the assumption that some factors can be iterated. It is
the core result that powers the analysis done in the upcoming
\cref{infix-finite-automata:thm,infix-amalgamation:thm}.

\begin{lemma}
    \label{pumping-periods:lem}
    Let $L \subseteq \Sigma^*$ be a language
    that is \kl{well-quasi-ordered} by the \kl{infix relation}.
    Let $k \in \Nat$, $u_1, \cdots, u_{k+1} \in \Sigma^*$,
    and $v_1, \cdots, v_{k} \in \Sigma^+$
    be such that
    $w[\vec{n}] \defined (\prod_{i = 1}^k u_i v_i^{n_i}) u_{k+1}$
    belongs to $L$
    for arbitrarily large values of $\vec{n} \in \Nat^k$.
    Then, 
    there exists $x,y \in \Sigma^+$ of size 
    at most $\max \setof{\card{v_i}}{1 \leq i \leq k}$
    such that 
    one of the following holds for all
    $\vec{n} \in \Nat^{k}$:
    \begin{enumerate}
        \item $w[\vec{n}] \in u_1 \InfPeriodChain{x}$,
        \item $w[\vec{n}] \in \InfPeriodChain{x} u_{k+1}$,
        \item $w[\vec{n}] \in \InfPeriodChain{x} u_i \InfPeriodChain{y}$
            for some $1 \leq i \leq k + 1$.

    \end{enumerate}
\end{lemma}
\begin{proof}
    Note that the result is obvious if $k = 0$, and therefore
    we assume $k \geq 1$ in the following proof.

    Let us construct a sequence of words $\seqof{w_i}[i \in \Nat]$, where $w_i
    \defined w[\vec{n_i}]$ for some well-chosen indices $\vec{n_i} \in \Nat^k$. The goal
    being that 
    if $w[\vec{n_i}]$ is an \kl{infix} of $w[\vec{n_j}]$,
    then it can intersect at most \emph{two} iterated words,
    with an intersection that is long enough to successfully apply
    \cref{periodic-infixes:lem}.
    In order to achieve this,
    let us first define $s$ as the maximal size of a word $v_i$
    ($1 \leq i \leq k$) and $u_j$ ($1 \leq j \leq k+1$).
    Then,
    we consider $\vec{n_0} \in \Nat^k$ such that $\vec{n_0}$ has all 
    its components greater than $\factorial{s}$ and such that
    $w[\vec{n_0}]$ belongs to $L$. 
    Then, we inductively define 
    $\vec{n_{i+1}}$  as the smallest vector of numbers greater than $\vec{n_i}$,
    such that $w[\vec{n_{i+1}}]$ belongs to $L$, 
    and with $\vec{n_i}$ having all components greater than
    $2\card{w[\vec{n_i}]}$.


    Let us assume that $k \geq 2$ in the following proof for symmetry purposes,
    and argue later on that when $k = 1$ the same argument goes through.
    Because $L$ is \kl{well-quasi-ordered} by the \kl{infix relation}, there
    exists $i < j$ such that $w[\vec{n_i}]$ is an \kl{infix} of $w[\vec{n_j}]$.
    Now, because of the chosen values for $\vec{n_j}$, there exists $1 \leq \ell \leq
    k-1$ such that $w[\vec{n_i}]$ is actually an \kl{infix} of $u_{\ell}
    v_{\ell}^{n_{j,\ell}} u_{\ell+1} v_{\ell+1}^{n_{j,\ell+1}} u_{\ell+2}$.
    Even more,
    one of the three following equations holds:
    \begin{itemize}
        \item $w[\vec{n_i}] \infleq v_{\ell}^{n_{j,\ell}} u_{\ell+1} v_{\ell+1}^{n_{j,\ell+1}}$,
        \item $w[\vec{n_i}] \infleq u_{\ell}
            v_{\ell}^{n_{j,\ell}}$,
        \item $w[\vec{n_i}] \infleq
            v_{\ell+1}^{n_{j,\ell+1}} u_{\ell+2}$.
    \end{itemize}
    In all those cases, we conclude using \cref{powers-infixes:cor}
    that there exists $x,y \in \Sigma^+$ of size at most $s$, and 
    a number $1 \leq t \leq k$ such that
    $v_i^{n_i} \in \InfPeriodChain{x}$ for all $1 \leq i \leq t$,
    and
    $v_i^{n_i} \in \InfPeriodChain{y}$ for all $t < i \leq k$.
    In particular,
    $w[\vec{n_i}] \in \InfPeriodChain{x} u_{t} \InfPeriodChain{y}$.

    
    When $k = 1$, the situation is a bit more specific since we only have two
    cases: either $w_i \infleq u_1 v_1^{n_j}$ or $w_i \infleq v_1^{n_j} u_2$,
    and we conclude with an identical reasoning.
\end{proof}


We are now ready to restate and prove our main theorem, proven by combining
\cref{pumping-periods:lem} together with classical pumping arguments on finite
state automata.

\begin{proofof}{infix-finite-automata:thm}
    Let $w \in L$, because $Q$ is finite, there exists
    a factorization of $w$
    into words $(\prod_{i = 1}^k u_i v_i) u_{k+1}$
    such that 
    for all $1 \leq i \leq k+1$, $\card{u_i} \leq \card{Q}$,
    for all $1 \leq i \leq k$, $1 \leq \card{v_i} \leq \card{Q}$,
    and satisfying 
    that $w[\vec{X}] \defined 
    (\prod_{i = 1}^k u_i v_i^{X_i}) u_{k+1}$
    belongs to $L$ for all choices of values $\vec{X} \in \Nat^k$.

    Applying \cref{pumping-periods:lem}, we conclude that 
    there exists $x,y \in \Sigma^+$ of size at most $\card{Q}$
    such that 
    $w \in u_1 \InfPeriodChain{x} \cup \InfPeriodChain{y} u_{k+1}
    \cup \bigcup_{1 \leq i \leq k+1} \InfPeriodChain{x} u_i \InfPeriodChain{y}$.
    In particular, we conclude that
    \begin{equation}
        \label{infix-automata:eq}
        L
        \subseteq
        \bigcup_{x,y,u\in \Sigma^{\leq \card{Q}}}
        u \InfPeriodChain{x}
        \cup 
        \InfPeriodChain{x} u
        \cup
        \InfPeriodChain{x} u \InfPeriodChain{y}
        \quad .
    \end{equation}

    Now, thanks to \cref{inf-period-union-chains:lem},
    this happens to be a finite union of \kl{chains}
    for the \kl{infix relation}.
\end{proofof}



\begin{corollary}
    \label{reg-wqo-decidable:cor}
    Given a regular language $L$, it is decidable whether
    $L$ is \kl{well-quasi-ordered} for the \kl{infix relation}.
\end{corollary}
\begin{proof}
    It suffices to decide whether 
    \cref{infix-automata:eq} holds for the language $L$.
    This is an inclusion of regular languages, which is decidable.
\end{proof}


Let $(X,\preceq)$ be a quasi-ordered set, and $L \subseteq X$ be such that $(L,
\preceq)$ is \kl{well-quasi-ordered}. It is not true in general that
$(\dwset{L}, \preceq)$ is \kl{well-quasi-ordered}. In the case of $(\Sigma^*,
\infleq)$ a typical example is to start from an infinite \kl{antichain} $A$,
together with an enumeration $\seqof{w_i}$ of $A$, and build the language $L
\defined \setof{ \prod_{i = 0}^n w_i }{ i \in \Nat }$. By definition, $L$ is a
\kl{chain} for the \kl{infix} ordering, hence \kl{well-quasi-ordered}. However,
$\dwset[\infleq]{L}$ contains $A$, and is therefore not
\kl{well-quasi-ordered}. As a fun corollary of our analysis, we conclude that
this particular example cannot be realized by a regular language $A$.


\begin{corollary}
    \label{reg-wqo-iff-dwclosed-wqo:cor}
    Given a regular language $L$, it is \kl{well-quasi-ordered} 
    for the \kl{infix relation} if and only if 
    $\dwset[\infleq] L$ is.
\end{corollary}

\begin{theorem}
    \label{bounded-language:thm}
    Let $L$ be a \kl{bounded language} of $\Sigma^*$. Then,
    $L$ is a \kl{well-quasi-order} when endowed with the 
    \kl{infix relation} if and only if it is a finite union of \kl{grids}.
\end{theorem}
\begin{proof}
    Let $w_1, \dots, w_n$ be such that
    $L \subseteq w_1^* \cdots w_n^*$.
    Let us define $m \defined \max \setof{\card{w_i}}{1 \leq i \leq n}$

    Let $w[\vec{k}] \defined w_1^{k_1} \cdots w_n^{k_n}$ be a map from $\Nat^k$
    to $\Sigma^*$. We are interested in the intersection of the image of $w$
    with $L$. Let us assume for instance that for all $\vec{k} \in \Nat^n$,
    there exists $\vec{\ell} \geq \vec{k}$ such that $w[\vec{\ell}] \in L$.
    Then, leveraging \cref{pumping-periods:lem}, we conclude that there exists
    $x,y$ of size at most $\max\setof{\card{w_i}}{1 \leq i \leq n}$ such that
    $w[\vec{k}] \in \InfPeriodChain{x} \cup \InfPeriodChain{x}
    \InfPeriodChain{y}$, and we conclude that $L \subseteq \InfPeriodChain{x}
    \cup \InfPeriodChain{x} \InfPeriodChain{y}$.

    Now, it may be the case that one cannot simultaneously assume that two
    component of the vector $\vec{k}$ are unbounded. In general, given a set $S
    \subseteq \set{1, \dots, n}$ of indices, we say that $S$ is admissible if
    there exists a bound $N_0$ such that for all $\vec{b} \in \Nat^S$, there
    exists a vector $\vec{k} \in \Nat^n$, such that $\vec{k}$ is greater than
    $\vec{b}$ on the $S$ components, and the other components are below the
    bound $N_0$. The language of an admissible set $S$ is the set of words
    obtained by repeating $w_i$ at most $N_0$ times if it is not in $S$
    ($w_i^{\leq N_0}$) and arbitrarily many times otherwise ($w_i^*$).
    Note that $L \subseteq \bigcup_{S \text{ admissible }} L(S)$.

    Now, admissible languages are ready to be pumped according to
    \cref{pumping-periods:lem}. For every admissible language,
    the size of a word that is not iterated is at most
    $N_0 \times m$ by definition, and we conclude that:
    \begin{equation*}
        L \subseteq 
        \bigcup_{x,y \in \Sigma^{\leq n}}
        \bigcup_{u \in \Sigma^{\leq m \times N_0}}
        \InfPeriodChain{x} u \InfPeriodChain{y}
        \cup
        \InfPeriodChain{x} u
        \cup
        u \InfPeriodChain{x}
        \quad .
    \end{equation*}
\end{proof}

Note that this immediately generalizes \cref{reg-wqo-iff-dwclosed-wqo:cor}
to all \kl{bounded languages}.

\begin{corollary}
    \label{bounded-wqo-dwclosed:cor}
    Let $L$ be a \kl{bounded language} of $\Sigma^*$. Then,
    $L$ is a \kl{well-quasi-order} when endowed with the
    \kl{infix relation} if and only if $\dwset[\infleq]{L}$ is.
\end{corollary}


In the light of \cref{reg-wqo-iff-dwclosed-wqo:cor,bounded-wqo-dwclosed:cor}
one may wonder whether the \kl{downwards closed}
languages for the \kl{infix relation} satisfy a similar characterization in
terms of union of \kl{grids} as stated in
\cref{infix-finite-automata:thm,bounded-language:thm}. Let us
first remark that from our previous results we obtain the following lemma that
illustrates how all the previous characterizations of \kl{well-quasi-ordered}
languages for the \kl{infix relation} are collapsing in the case of
\kl{downwards closed} languages.

\begin{lemma}
    \label{dwclosed-infixes-wqo:lem}
    Let $L \subseteq \Sigma^*$ be a \kl{downwards closed} language for the
    \kl{infix relation} that is \kl{well-quasi-ordered}. Then, the following
    are equivalent:
    \begin{enumerate}
        \item $L$ is \kl{bounded},
        \item $L$ is \kl{regular},
        \item $L$ is a finite union of \kl{chains} and \kl{grids}.
    \end{enumerate}
\end{lemma}
\begin{proof}
    TODO.
\end{proof}

One may think that all \kl{downwards closed} languages for the \kl{infix
relation} that are \kl{well-quasi-ordered} are \kl{regular}. Note that this is
what happens in the case of the \kl{subword embedding}, where any \kl{downwards
closed} language for this relation is characterized by finitely many excluded
patterns, hence \kl{regular}. However, this is not the case for the \kl{infix
relation}, as we will now illustrate with the following two examples.

\begin{example}
    \label{dwclosed-wqo-not-finite-excl:ex}
    Let $L \defined a^* b^* \cup b^* a^*$. This language is \kl{downwards
    closed} for the \kl{infix relation}, is \kl{well-quasi-ordered} for the
    \kl{infix relation}, but is characterized by an \emph{infinite} number 
    of excluded infixes, respectively of the form $ab^ka$ and $ba^kb$ where $k \geq 1$.
\end{example}

To strengthen \cref{dwclosed-wqo-not-finite-excl:ex}, we will
leverage the \intro{Thue-Morse sequence} $\intro*\ThueMorse \in
\set{0,1}^{\Nat}$, which we will use as a black-box for its two main
characteristics: it is \kl{cube-free} and \kl{uniformly recurrent}. Being
\intro{cube-free} means that no (finite) word of the form $uuu$ is an
\kl{infix} of $\ThueMorse$, and being \intro{uniformly recurrent} means that
for every word $u$ that is an \kl{infix} of $\ThueMorse$, there exists $k \geq
1$ such that $u$ is an \kl{infix} of every word $v$ of size at least $k$. We
refer the reader to a nice survey of Allouche and Shallit for more information
on this sequence and its properties \cite{ALSHA99}.

\begin{lemma}
    \label{thue-morse:lemma}
    There exists a language $L$ that is \kl{downwards closed} for the \kl{infix
    relation}, \kl{well-quasi-ordered} for the \kl{infix relation}, but is not
    \kl{regular}.
\end{lemma}
\begin{proof}
    Let $\ThueMorse$ be the \kl{Thue-Morse sequence}
    $L$ be the set of infixes of $w$. By construction $L$ is an \emph{infinite}
    \kl{downwards closed} for the \kl{infix relation}. Let us argue that $L$ is
    \kl{well-quasi-ordered} for the \kl{infix relation}, but is not \kl{regular}.

    Assume by contradiction that $L$ is \kl{bounded}. In this case, there exist
    words $w_1, \dots, w_k \in \Sigma^*$ such that $L \subseteq w_1^* \cdots
    w_k^*$. Since $L$ is infinite and \kl{downwards closed}, there exists a
    word $u \in L$ such that $u = w_i^3$ for some $1 \leq i \leq k$. This is absurd
    because $u \infleq \ThueMorse$, which is \kl{cube-free}.

    Furthermore, $L$ is \kl{well-quasi-ordered} for the \kl{infix relation}.
    Indeed, consider a sequence $\seqof{u_i}$ of words in $L$. Without loss of
    generality, we may consider a subsequence such that $\card{u_i} <
    \card{u_{i+1}}$ for all $i \in \Nat$. Because $\ThueMorse$ is \kl{uniformly
    recurrent}, there exists $k \geq 1$ such that $u_1$ is an \kl{infix} of
    every word $v$ of size at least $k$. In particular, $u_1$ is an \kl{infix}
    of $u_k$, hence the sequence $\seqof{u_i}$ is \kl(sequence){good}.

    We conclude thanks to
    \cref{dwclosed-infixes-wqo:lem}, that $L$ is not \kl{regular}.
\end{proof}

