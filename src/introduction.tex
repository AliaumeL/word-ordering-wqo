% LTeX: language=en-GB 
% !TeX root=../wqo-on-words.tex
\section{Introduction}
\label{introduction:sec}

\AP A \intro{well-quasi-ordered} set is a set $X$ equipped with a quasi-order
$\preceq$ such that every infinite sequence $\seqof{x_n}$ of elements taken in
$X$ contains an increasing pair $x_i \preceq x_j$ with $i < j$. Well-quasi-orderings serve
as a core combinatorial tool powering many termination arguments, and was
successfully applied to the verification of infinite state transition
systems~\cite{ABDU96,ABDU98}. One of the appealing properties of
well-quasi-orderings is that they are closed under many operations, such as
taking products, finite unions, and finite powerset
constructions~\cite{SCSC12}. Perhaps more surprisingly, the class of
well-quasi-ordered sets is also stable under the operation of taking finite
words and finite trees labelled by elements of a well-quasi-ordered set
\cite{HIG52,KRU72}.

\AP Note that in the case of finite words and finite trees, the precise choice
of ordering is crucial to ensure that the resulting structure is
\kl{well-quasi-ordered}. The celebrated result of Higman states that the set of
finite words over an ordered alphabet $(X, \preceq)$ is \kl{well-quasi-ordered}
by the so-called \kl{subword embedding relation}~\cite{HIG52}. Let us recall
that the \kl{subword relation} for words over $(X, \preceq)$ is defined as
follows: a word $u$ is a \intro{subword} of a word $v$, written $u
\intro*\higleq v$, if there exists an increasing function $f \colon \{1,
\ldots, |u|\} \to \{1, \ldots, |v|\}$ such that $u_i \preceq v_{f(i)}$ for all
$i \in \{1, \ldots, |u|\}$.

\begin{figure}
    \centering
    \begin{subfigure}[t]{0.48\textwidth}
    	\centering
    	\includestandalone[width=\linewidth]{fig/prefix-embedding-standalone}
    	\caption{Prefix Relation}
   	\end{subfigure}%
   	\hfill%
   	\begin{subfigure}[t]{0.48\textwidth}
   		\centering
   		\includestandalone[width=\linewidth]{fig/infix-embedding-standalone}
   		\caption{Infix Relation}
   	\end{subfigure}
   	\begin{subfigure}[t]{0.48\textwidth}
   		\centering
   		\includestandalone[width=\linewidth]{fig/subword-embedding-standalone}
   		\caption{Subword Relation}
   	\end{subfigure}
   	
   	\caption{A simple representation of the \kl{subword relation},
        \kl{prefix relation},
        and \kl{infix relation},
        on the alphabet $\set{a,b}$ for words of
        length at most $3$. The figures are Hasse Diagrams,
        representing the successor relation of the order.
        Furthermore, we highlight in dashed red relations that are added
        when moving from the prefix relation to the infix one,
        and to the infix relation to the subword one.}
    \label{word-embeddings:fig}
\end{figure}

\AP However, there are many other natural orderings on words that could be
considered in the context of \kl{well-quasi-orderings}, even in the simplified
setting of a finite alphabet $\Sigma$ equipped with the equality relation. In
this setting, the three alternatives we consider are the \intro{prefix
relation} ($u \intro*\prefleq v$ if there exists $w$ with $uw = v$), the
\intro{suffix relation} ($u \intro*\suffleq v$ if there exists $w$ such that
$wu = v$), and the \intro{infix relation} ($u \intro*\infleq v$ if there exists
$w_1,w_2$ such that $w_1 u w_2 = v$). Note that these three relations
straightforwardly generalize to infinite quasi-ordered alphabets.
Unfortunately, it is easy to see that none of these constructions are 
well-quasi-ordered as soon as the alphabet contains two distinct letters:
for instance, the infinite sequence $a^n b^n a^n$ is \kl{well-quasi-ordered} by
the \kl{subword relation} but by neither the \kl{prefix relation}, nor the
\kl{suffix relation}, nor the \kl{infix relation}.

\AP While this dooms \kl[well-quasi-ordered]{well-quasi-orderedness} of these
relations in the general case, there may be \emph{subsets} of $\Sigma^*$ which
are \kl{well-quasi-ordered} by these relations. As a simple example, take the
case of finite sets of (finite) words which are all \kl{well-quasi-ordered}
regardless of the ordering considered. This raises the question of
characterizing exactly which subsets $L \subseteq \Sigma^*$ are
\kl{well-quasi-ordered} with respect to the \kl{prefix relation} (respectively,
the \kl{suffix relation} or the \kl{infix relation}), and designing
suitable decision procedures.

\AP Let us argue that these decision procedures fit a larger picture in the
research area of well-quasi-orderings.
Indeed, there has been recent breakthroughs in deciding whether a given order
is a \kl{well-quasi-order}, for instance in the context of the verification of
infinite state transition systems~\cite{DBLP:conf/fsttcs/FinkelG19} or in the
context of logic~\cite{DBLP:journals/pacmpl/BergstrasserGLZ24}.
In the graph theory community, recent works have studied classes of graphs 
that are \kl{well-quasi-ordered} by the \kl{induced subgraph relation}
using similar language theoretic techniques~\cite{DRT10,L24:arxiv:v2,ALM17}.
Furthermore, a previous work by Kuske shows that any
\emph{reasonable}\footnote{ This will be made precise in
\cref{infix-embedding:thm}. } partially ordered set $(X, \leq)$ can
be embedded into $\set{a,b}^*$ with the \kl{infix relation}~\cite[Lemma
5.1]{DBLP:journals/ita/Kuske06}. Phrased differently, one can encode a large
class of partially ordered sets as subsets of $\set{a,b}^*$. As a consequence,
the following decision problem provides a reasonable abstract framework for
deciding whether a given partially ordered set is \kl{well-quasi-ordered}:
given a language $L \subseteq \Sigma^*$, decide whether $L$ is
\kl{well-quasi-ordered} by the \kl{infix relation}.

\AP The runtime of an algorithm based on \kl{well-quasi-orderings} is deeply
related to the ``complexity'' of the underlying quasi-order~\cite{SCHMITZ17}.
One way to measure this complexity is to consider its so-called \kl{ordinal
invariants}: for instance, the \kl{maximal order type} (or \kl{m.o.t.}),
originally defined by De Jongh and Parikh \cite{dejongh77}, is the order type
of the maximal linearization of a well-quasi-ordered set. In the case of a
finite set, the \kl{m.o.t.} is precisely the size of the set. Better runtime
bounds were obtained by considering two other parameters~\cite{SCHMITZ19}: the
\kl{ordinal height} introduced by Schmidt \cite{schmidt81}, and the \kl{ordinal
width} of Kříž and Thomas \cite{kriz90b}. Therefore, when characterizing
\kl{well-quasi-ordered} languages, we will also be interested in deriving upper
bounds on their \kl{ordinal invariants}. This analysis also allows us to better
compare the \kl{well-quasi-orderings}. We refer to
\cref{ordinal-invariants:subsec} for a more detailed introduction to these
parameters and ordinal computations in general.

\paragraph*{Contributions} We focus on languages over a finite alphabet
$\Sigma$. In this setting, we first characterize languages that are
\kl{well-quasi-ordered} by the \kl{prefix relation} (and symmetrically, by the
\kl{suffix relation}), and derive tight bounds on their \kl{ordinal
invariants}. These generic results are then used to devise a decision procedure
for checking whether a language is \kl{well-quasi-ordered} by the \kl{prefix
relation}, provided the language is given as input as a finite automaton
(\cref{prefix-wqo-reg-decidable:cor}). A
summary of these results can be found in \cref{prefixes-summary:fig}.

\begin{figure}[h]
    \centering
    \begin{tabular}{c|c|c|c}
        \toprule
        $L$ & \textbf{Characterisation} & $\oWidth{L}$ & $\oType{L}$ \\
        \midrule
        arbitrary & Finite unions of \kl{chains} \cref{prefixes:thm} & $< \omegaOrd$ & $< \omegaOrd^2$ \\
        regular   & Finite unions of \kl(language){regular} \kl{chains} \cref{prefix-wqo-reg-decidable:cor} & $< \omegaOrd$ & $< \omegaOrd^2$ \\
        \bottomrule
    \end{tabular}
    \caption{Summary of results for the \kl{prefix relation} (and symmetrically, for the \kl{suffix relation}).}
    \label{prefixes-summary:fig}
\end{figure}

We then turn our attention to the \kl{infix relation}. In this case, we notice
that Lemma 5.1 from \cite{DBLP:journals/ita/Kuske06} imply that there are
\kl{well-quasi-ordered} languages for the \kl{infix relation} that have
arbitrarily large \kl{ordinal invariants} (except for the \kl{ordinal height},
which is always at most $\omegaOrd$). Therefore, we focus on two natural
semantic restrictions on languages: on the one hand, we consider \kl{bounded
languages}, that is, languages included in some $w_1^* \cdots w_k^*$ for some
finite choice of words $w_1, \ldots, w_k$; on the other hand, we consider
\kl{downwards closed} languages, that is, languages closed under taking
\kl{infixes}. In both cases, we provide a very precise characterization of
\kl{well-quasi-ordered} languages by the \kl{infix relation}, and derive tight
bounds on their \kl{ordinal invariants}. These results are summarized in
\cref{infixes-summary:fig}. \todo{this is not what the corollary says} We furthermore notice that for \kl{downwards
closed} languages that are \kl{well-quasi-ordered} by the \kl{infix relation},
being \kl(language){bounded} is the same as being \kl(language){regular}
(\cref{bounded-wqo-dwclosed:cor}), and that a \kl{bounded language} is
\kl{well-quasi-ordered} by the \kl{infix relation} if and only if its
\kl{downwards closure} is \kl{well-quasi-ordered} by the \kl{infix relation}
(\cref{bounded-wqo-dwclosed:cor}). This shows that, for \kl{bounded languages},
being \kl{well-quasi-ordered} implies that their \kl{downwards closure} is a
\kl{regular language}, which is a weakening of the usual result that the
\kl{downwards closure} of \emph{any language} for the \kl{scattered subword
relation} is always a \kl{regular language}.


\begin{figure}[h]
  \centering
  \begin{tabular}{c|c|c|c}
      \toprule
      $L$ & \textbf{Characterisation} & $\oWidth{L}$ & $\oType{L}$ \\
      \midrule
      arbitrary & \cref{infix-embedding:thm} & $< \omegaOne$  & $< \omegaOne$ \\
      bounded & \cref{bounded-language:thm} & $< \omegaOrd^2$ & $< \omegaOrd^3$ \\
      downwards closed & \cref{small-ordinal-invariants:thm} & $< \omegaOrd^2$ & $< \omegaOrd^3$ \\
      \bottomrule
    \end{tabular}
    \caption{Summary of results for the \kl{infix relation}.}
    \label{infixes-summary:fig}
\end{figure}

Turning our attention to decision procedures, we consider two computational
models respectively tailored to \kl{downwards closed} languages and to
\kl{bounded languages}. For \kl{downwards closed} languages, we consider a
model based on representations of infinite words
(\cref{decision-procedures:sec}), for which we provide a decision procedure
(\cref{automatic-wqo:thm}). The model used to represent these infinite words is
based on \kl{automatic sequences} and \kl{morphic sequences} \cite{CAKA97},
which are well-studied in the context of symbolic dynamics. For \kl{bounded
languages}, we consider the model of \kl{amalgamation systems} \cite{ASZZ24},
which is an abstract computational model that encompasses many classical ones,
such as finite automata, context-free grammars, and Petri nets \cite{ASZZ24}.
We show that if a language recognized by an \kl{amalgamation system} is
\kl{well-quasi-ordered} by the \kl{infix relation}, then it is a \kl{bounded
language} (\cref{infix-amalgamation:thm}), and is therefore
\kl(language){regular}. Furthermore, we show that we can decide whether a given
language recognized by an \kl{amalgamation system} is \kl{well-quasi-ordered}
by the \kl{infix relation} (\cref{infix-wqo-is-emptiness:thm}). We defer the
introduction of \kl{amalgamation systems} to
\cref{amalgamation-systems:subsec}.

\todo[inline]{
  rework the content so that cited things exists and/or are 
  corollaries and theorems (mainly). Also, add results to prove that 
  bounds are tight!
}

\paragraph*{Related work} The study of alternative \kl{well-quasi-ordered}
relations over finite words is far from new. For instance, orders obtained by
so-called \emph{derivation relations} where already analysed by Bucher,
Ehrenfeucht, and Haussler \cite{BUEUD85}, and were later extended by
D'Alessandro and Varricchio \cite{ALVA03,ALVA06}. However, in all those cases
the orderings are \emph{multiplicative}, that is, if $u_1 \preceq v_1$ and $u_2
\preceq v_2$ then $u_1u_2 \preceq v_1v_2$. This assumption does not hold for
the \kl{prefix}, \kl{suffix}, and \kl{infix} relations.

A similar question was studied by Atminas, Lozin, and Moshkov \cite{ALM17}, in
the hope of finding characterizations of classes of \emph{finite graphs} that
are \kl{well-quasi-ordered} by the \emph{induced subgraph relation}
\cite[Section 7]{ALM17}. In this setting, it is common to refer to classes of
graphs via a list of \emph{forbidden patterns}, which are finite graphs that
cannot be found as induced subgraphs in the class. Applying this reasoning to
finite words with the \kl{infix relation}, they provide an efficient decision
procedure for checking whether a language $L \subseteq \Sigma^*$ is
\kl{well-quasi-ordered} by the \kl{infix relation} whenever said language is
given as input via a list of \emph{forbidden factors} \cite[Theorem 1, Theorem
2]{ALM17}. The key construction of their paper is to study languages $L$ that
are \emph{regular} (recognized by some finite deterministic automata), for
which they can decide whether $L$ is \kl{well-quasi-ordered} by the \kl{infix
relation} \cite[Theorem 1]{ALM17}. Because it is easy to transform a list of
forbidden factors into a regular language \cite[Theorem 1]{ALM17}, this yields
the desired decision procedure. Our work extends this result in several ways:
first, we also consider the \kl{prefix relation} and the \kl{suffix relation},
then we consider non-regular languages, and finally, we provide very precise
descriptions of the \kl{well-quasi-ordered} languages, as well as tight bounds
on their \kl{ordinal invariants}. In particular, we highlight the role of
\kl{bounded languages} as the one that are well-behaved with respect to being
\kl{well-quasi-ordering} by the \kl{infix relation} \cref{infixes-bounded:sec}.

\paragraph*{Outline} 
We introduce in \cref{prelims:sec} the
necessary background on \kl{well-quasi-orders} and \kl{ordinal invariants}.
In
\cref{prefixes:sec}, which is relatively
self-contained, we study the \kl{prefix relation} and prove in
\cref{prefixes:thm} the characterization of \kl{well-quasi-ordered}
languages by the \kl{prefix relation}. In
\cref{infixes-bounded:sec}, we
obtain the \kl[infix relation]{infix} analogue of \cref{prefixes:thm}
specifically for \kl{bounded languages}
(\cref{bounded-language:thm}). 
In \cref{infixes-dwclosed:sec}, we study the \kl{downwards closed}
languages, and compute bounds on their \kl{ordinal invariants} in \cref{small-ordinal-invariants:thm}.
Finally, 
we generalize these results to all
\kl{amalgamation systems} in \cref{infixes-amalgamation:sec}
in
(\cref{infix-amalgamation:thm}),
and provide a decision procedure for checking whether a language is
\kl{well-quasi-ordered} by the \kl{infix relation} (resp. \kl{prefix} and \kl{suffix}) in
this context (\cref{infix-wqo-is-emptiness:thm}).

\paragraph*{Acknowledgements} We would like to thank participants of the 2024
edition of \kl{Autobóz} for their helpful comments and discussions.
We would also like to thank Vincent Jugé for his pointers on word combinatorics.
