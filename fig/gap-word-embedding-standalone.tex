\documentclass[tikz]{standalone}

\usepackage{../ensps-colorscheme}
\input{../lib/packages}
\input{../lib/aliaume}
\input{../lib/maths}


\begin{document}
\begin{tikzpicture}[
        embedding/.style={
            thick, ->, >=stealth,
            A2
        },
        gapWord/.style={
            fill=B5bg,
        },
        startWord/.style={
            fill=D4bg,
        },
        ]

    % The word "u"
    \node (u) at (2,-0.5) {$u$};
    \draw[startWord] (0,-0.1) rectangle (4,-0.2);
    \draw (0,0) rectangle (4,1);
    \foreach[count=\xi] \x in {0,1,2,3} {
        \pgfmathsetmacro{\xp}{int(\x + 1)}
        \draw[startWord] (\x,0) rectangle (\xp,1);
        \node (u\xi) at (\x+0.5,0.5) {$u_{\xi}$};
    }

    \begin{scope}[yshift=3cm,xshift=-5cm]
        % The word "v"
        \draw (0,0) rectangle (15,1);
        \foreach[count=\xi] \x in {0,1,2,3,4,5,6,7,8,9,10,11,12,13,14} {
            \pgfmathsetmacro{\xp}{int(\x + 1)}
            \draw (\x,0) rectangle (\xp,1);
            \node (v\xi) at (\x+0.5,0.5) {$v_{\xi}$};
        }
    \end{scope}

    \foreach \xi/\yi in {1/3,2/6,3/9,4/13} {
        \draw[startWord] ({\yi - 5},3) rectangle ({\yi - 6},4);
        \node (uv\xi) at ({\yi - 5.5},3.5) {$u_{\xi}$};
        \draw[embedding] (u\xi) to[in=-90,out=90] (v\yi);
    }

    \foreach[count=\count] \xi/\size in {1/2,4/2,7/2,10/3,14/2} {
        \draw[gapWord] ({\xi - 6 + \size},2.9) rectangle ({\xi - 6},2.8);
        \node (G\xi) at ({\xi - 6 + 0.5*\size},2.5) {$\GapWord{f}{\count}$};
    }

    \draw[gapWord] (-5,4.1) rectangle (10,4.2);
    \node (v) at (2,4.5) {$v$};

    \node[embedding] (f) at (2,1.5) {$f$};


\end{tikzpicture}
\end{document}
        
